<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdminToolbox</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        h1 { text-align: center; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input[type="text"], textarea { width: 100%; padding: 5px; }
        button { padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        #result { margin-top: 20px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>AdminToolbox</h1>
        <div class="form-group">
            <label for="computerName">Computer Name:</label>
            <input type="text" id="computerName" value="localhost">
        </div>
        <div class="form-group">
            <label for="action">Action:</label>
            <select id="action">
                <option value="registry_key">Registry Key Retrieval</option>
                <option value="compare_version">Compare Versions</option>
                <option value="read_xml">Read XML File</option>
                <option value="write_xml">Write XML File</option>
                <option value="modify_xml">Modify XML File</option>
                <option value="admin_permissions">Admin Permissions</option>
                <option value="execute_program">Execute Program</option>
            </select>
        </div>
        <div id="dynamicFields"></div>
        <button onclick="performAction()">Execute</button>
        <div id="result"></div>
    </div>
    <script>
        const actionFields = {
            registry_key: ['key', 'value_name'],
            compare_version: ['current_version', 'target_version'],
            read_xml: ['file_path'],
            write_xml: ['file_path', 'xml_content'],
            modify_xml: ['file_path', 'xpath', 'new_value'],
            admin_permissions: ['username', 'action'],
            execute_program: ['program_name', 'args']
        };

        function updateDynamicFields() {
            const action = document.getElementById('action').value;
            const dynamicFields = document.getElementById('dynamicFields');
            dynamicFields.innerHTML = '';
            actionFields[action].forEach(field => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label for="${field}">${field.replace('_', ' ')}:</label>
                    ${field === 'xml_content' ? 
                        `<textarea id="${field}"></textarea>` : 
                        `<input type="text" id="${field}">`}
                `;
                dynamicFields.appendChild(div);
            });
        }

        document.getElementById('action').addEventListener('change', updateDynamicFields);
        updateDynamicFields();

        function performAction() {
            const action = document.getElementById('action').value;
            const computerName = document.getElementById('computerName').value;
            const data = { computer_name: computerName };
            actionFields[action].forEach(field => {
                data[field] = document.getElementById(field).value;
            });

            axios.post(`/api/${action}`, data)
                .then(response => {
                    document.getElementById('result').textContent = JSON.stringify(response.data, null, 2);
                })
                .catch(error => {
                    document.getElementById('result').textContent = `Error: ${error.message}`;
                });
        }

        // Check if the system is Windows and disable registry key option if not
        function checkWindowsSystem() {
            axios.get('/api/is_windows')
                .then(response => {
                    const isWindows = response.data.is_windows;
                    const registryOption = document.querySelector('option[value="registry_key"]');
                    if (!isWindows) {
                        registryOption.disabled = true;
                        registryOption.textContent += " (Windows only)";
                    }
                })
                .catch(error => {
                    console.error("Error checking Windows system:", error);
                });
        }

        // Call the function when the page loads
        window.onload = checkWindowsSystem;
    </script>
</body>
</html>
